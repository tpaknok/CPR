<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CPR">
<title>Empirical Analyses with CPR • CPR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Analyses with CPR">
<meta property="og:description" content="CPR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CPR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Empirical.html">Empirical Analyses with CPR</a>
    <a class="dropdown-item" href="../articles/Simulation.html">Simulation with CPR</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tpaknok/CPR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Empirical Analyses with CPR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tpaknok/CPR/blob/HEAD/vignettes/Empirical.Rmd" class="external-link"><code>vignettes/Empirical.Rmd</code></a></small>
      <div class="d-none name"><code>Empirical.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>This is an R Markdown document describing the empirical analyses
conducted in Tsang et al. (2024). Again, you will need to install and
load multiple packages and data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tpaknok/CPR" class="external-link">CPR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR_MLtree"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR_EF"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s get the variane covariance matrix at species and community
level.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span> <span class="co">#species level phyologenetic covariance matrix using default (Brownian) model</span></span>
<span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">VCV_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp</span><span class="op">)</span></span>
<span><span class="va">VCV_comm</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.7031681 0.5639611 0.5601336 0.7539047</span></span>
<span><span class="co">#&gt; [2,] 0.7031681 1.0000000 0.5458038 0.5420995 0.7048548</span></span>
<span><span class="co">#&gt; [3,] 0.5639611 0.5458038 1.0000000 0.9932127 0.5749535</span></span>
<span><span class="co">#&gt; [4,] 0.5601336 0.5420995 0.9932127 1.0000000 0.5710514</span></span>
<span><span class="co">#&gt; [5,] 0.7539047 0.7048548 0.5749535 0.5710514 1.0000000</span></span></code></pre></div>
<p>The KSR_EF data have multiple ecosystem function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Plot Real.rich Legume       Hed       PD     MNND      MPD         H</span></span>
<span><span class="co">#&gt; 1   X2         1      N 0.0000000   0.0000   0.0000   0.0000 0.0000000</span></span>
<span><span class="co">#&gt; 2   X3         4     LP 1.3772918 456.7786 136.7786 258.9262 1.1761865</span></span>
<span><span class="co">#&gt; 3   X4         2      N 0.6931472 320.0000 320.0000 320.0000 0.2249718</span></span>
<span><span class="co">#&gt; 4   X7         1      N 0.0000000   0.0000   0.0000   0.0000 0.0000000</span></span>
<span><span class="co">#&gt; 5   X8         3     LP 1.0934269 418.9892 238.6522 279.3261 0.7560967</span></span>
<span><span class="co">#&gt; 6   X9         1      N 0.0000000   0.0000   0.0000   0.0000 0.0000000</span></span>
<span><span class="co">#&gt;        Simp biomass2012 litter2012 biomass2013 biomass2014 ave.biomass</span></span>
<span><span class="co">#&gt; 1 0.0000000       47.89      79.05       35.39       15.64    32.97333</span></span>
<span><span class="co">#&gt; 2 0.6712373      122.24      74.23       74.33       50.66    82.41000</span></span>
<span><span class="co">#&gt; 3 0.1115254       77.93      34.50       59.62       51.23    62.92667</span></span>
<span><span class="co">#&gt; 4 0.0000000       44.37      36.32       44.69       14.09    34.38333</span></span>
<span><span class="co">#&gt; 5 0.5120332      166.82      21.46      148.84      125.51   147.05667</span></span>
<span><span class="co">#&gt; 6 0.0000000       44.37      37.26       32.12       24.92    33.80333</span></span>
<span><span class="co">#&gt;   Light.tau  LAI C.change.deep C.change.surf N.change.deep N.change.surf</span></span>
<span><span class="co">#&gt; 1     0.312 1.67        -0.331        -0.031         0.007        -0.010</span></span>
<span><span class="co">#&gt; 2     0.031 5.53         1.762         0.111        -0.046        -0.009</span></span>
<span><span class="co">#&gt; 3     0.100 3.04        -0.518         0.421        -0.012         0.024</span></span>
<span><span class="co">#&gt; 4     0.083 3.42        -0.156        -0.009        -0.087        -0.028</span></span>
<span><span class="co">#&gt; 5     0.006 7.14            NA            NA        -0.045         0.031</span></span>
<span><span class="co">#&gt; 6     0.499 1.01        -1.895        -0.128         0.066         0.017</span></span>
<span><span class="co">#&gt;   mean.N.change poll_total flwr_total Mass.loss.1month Mass.loss.2month</span></span>
<span><span class="co">#&gt; 1       -0.0015         20 43113.5000            2.891            3.362</span></span>
<span><span class="co">#&gt; 2       -0.0275         53  2126.1429            3.147            3.718</span></span>
<span><span class="co">#&gt; 3        0.0060        150   324.4286            2.972            3.521</span></span>
<span><span class="co">#&gt; 4       -0.0575          0     0.0000            2.714            3.328</span></span>
<span><span class="co">#&gt; 5       -0.0070          0     0.0000            3.283            3.608</span></span>
<span><span class="co">#&gt; 6        0.0415          0     0.0000            3.020            3.627</span></span>
<span><span class="co">#&gt;         GRASS SOAL       MOFI ASTU       DECA Damage_effect bugs bug.rich</span></span>
<span><span class="co">#&gt; 1          NA   NA         NA   NA         NA     0.0000000    9        7</span></span>
<span><span class="co">#&gt; 2 -0.34584386   NA         NA   NA 0.04572438    -0.3001195    7        6</span></span>
<span><span class="co">#&gt; 3 -0.04241343   NA -0.3771144   NA         NA    -0.4195279    4        2</span></span>
<span><span class="co">#&gt; 4          NA   NA         NA   NA         NA     0.0000000    5        3</span></span>
<span><span class="co">#&gt; 5 -2.74600928   NA         NA   NA         NA    -2.7460093    4        4</span></span>
<span><span class="co">#&gt; 6          NA   NA         NA   NA         NA     0.0000000   11        7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<table class="table">
<colgroup>
<col width="23%">
<col width="76%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Plot</td>
<td>Plot identity</td>
</tr>
<tr class="even">
<td>Real.rich</td>
<td>Number of species planted</td>
</tr>
<tr class="odd">
<td>litter2012</td>
<td>Amount of litter measured in 2012</td>
</tr>
<tr class="even">
<td>ave.biomass</td>
<td>Average biomass across 2012-2014</td>
</tr>
<tr class="odd">
<td>LAI</td>
<td>Leaf area index, a simplified dimension of structural
complexity</td>
</tr>
<tr class="even">
<td>mean.N.change</td>
<td>delta 15N change averaged across surface and deep soil</td>
</tr>
<tr class="odd">
<td>poll_total</td>
<td>Total number of pollinators</td>
</tr>
<tr class="even">
<td>flwr_total</td>
<td>Total number of flowers</td>
</tr>
<tr class="odd">
<td>Mass.loss.2month</td>
<td>Decomposition after 2 months</td>
</tr>
<tr class="even">
<td>Damage_effect</td>
<td>Damage reduction effect</td>
</tr>
<tr class="odd">
<td>bugs</td>
<td>Total number of arthropods</td>
</tr>
<tr class="even">
<td>bug.rich</td>
<td>Species richness of arthropods</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="empirical-analyses---single-function">Empirical analyses - Single function<a class="anchor" aria-label="anchor" href="#empirical-analyses---single-function"></a>
</h2>
<p>We repeated the analyses in <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.2045?casa_token=dROW6fWW92EAAAAA%3AuXcUC3seoCFkzpoV1Zb6_PSzxjkN7_8H1jhBYjjzTiF0-g3tPsfV1lFQVN4k1QiNRTLwqWbl4PW_nQ" class="external-link">Cadotte
et al. (2017)</a>, involving ten ecosystem functions. If only one
ecosystem function is of interest (or if you don’t mind your code is
clunky), you can just use INLA and write similar functions ten times.
For example, let’s analyze flower abundance.</p>
<p>INLA is a very powerful package, but can be a bit complicated to use.
As it is a Bayesian analysis, we have to specify priors. INLA has
different default priors and check their <a href="https://becarioprecario.bitbucket.io/inla-gitbook/ch-priors.html" class="external-link">website</a>
if you are interested. Here, we will use the penalizing complexity
prior. The specification is identical with the phyr, an R package for <a href="https://daijiang.github.io/phyr/index.html" class="external-link">Bayesian community
PGLMM</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">log_flwr_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">flwr_total</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="co">#log-transforming floral abundance to facilitate covnergence in INLA</span></span>
<span></span>
<span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span> <span class="co">#need to create an unique identifier for each comm in INLA</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span>,data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sdres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">sdres</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">prior1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior<span class="op">=</span><span class="st">"pc.prec"</span><span class="op">)</span>,param<span class="op">=</span><span class="va">param</span><span class="op">)</span> <span class="co">#You can specify your own prior too. </span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">comm</span>,model<span class="op">=</span><span class="st">"generic0"</span>,Cmatrix<span class="op">=</span><span class="va">P.lambda</span>,hyper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span><span class="op">)</span> <span class="co">#start with the formula. Note that P.lambda is just a placeholder </span></span>
<span></span>
<span><span class="va">ML.opt2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>               <span class="va">likelihood.lambda.INLA</span>,</span>
<span>               inla_formula<span class="op">=</span> <span class="va">f</span>,</span>
<span>               family<span class="op">=</span><span class="st">"gaussian"</span>,</span>
<span>               data<span class="op">=</span><span class="va">KSR_EF</span>,</span>
<span>               phyV<span class="op">=</span><span class="va">VCV_sp</span>,</span>
<span>               comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior1 <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span>,</span>
<span>               control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>               method<span class="op">=</span><span class="st">"L-BFGS-B"</span>,</span>
<span>               lower<span class="op">=</span><span class="fl">0.0</span>,</span>
<span>               upper<span class="op">=</span><span class="fl">1.0</span>,</span>
<span>               control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>factr<span class="op">=</span><span class="fl">1e9</span><span class="op">)</span><span class="op">)</span> <span class="co">#Slow</span></span>
<span></span>
<span><span class="va">lambda_INLA</span><span class="op">&lt;-</span><span class="va">ML.opt2</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">wAIC</span> <span class="op">&lt;-</span> <span class="va">ML.opt2</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">VCV_sp_INLA</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">*</span><span class="va">lambda_INLA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VCV_sp_INLA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span></span>
<span><span class="va">C.lambda.INLA</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp_INLA</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">prec.mat.INLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">C.lambda.INLA</span><span class="op">)</span> <span class="co">#note that INLA requires a precision matrix, not a VCV</span></span>
<span></span>
<span><span class="va">optim_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">comm</span>,</span>
<span>                                           model<span class="op">=</span><span class="st">"generic0"</span>,</span>
<span>                                           Cmatrix<span class="op">=</span><span class="va">prec.mat.INLA</span>,</span>
<span>                                           hyper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span>,</span>
<span>                data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">optim_m</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;    c("inla.core(formula = formula, family = family, contrasts = contrasts, </span></span>
<span><span class="co">#&gt;    ", " data = data, quantiles = quantiles, E = E, offset = offset, ", " </span></span>
<span><span class="co">#&gt;    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, </span></span>
<span><span class="co">#&gt;    ", " lp.scale = lp.scale, link.covariates = link.covariates, verbose = </span></span>
<span><span class="co">#&gt;    verbose, ", " lincomb = lincomb, selection = selection, control.compute </span></span>
<span><span class="co">#&gt;    = control.compute, ", " control.predictor = control.predictor, </span></span>
<span><span class="co">#&gt;    control.family = control.family, ", " control.inla = control.inla, </span></span>
<span><span class="co">#&gt;    control.fixed = control.fixed, ", " control.mode = control.mode, </span></span>
<span><span class="co">#&gt;    control.expert = control.expert, ", " control.hazard = control.hazard, </span></span>
<span><span class="co">#&gt;    control.lincomb = control.lincomb, ", " control.update = </span></span>
<span><span class="co">#&gt;    control.update, control.lp.scale = control.lp.scale, ", " </span></span>
<span><span class="co">#&gt;    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, </span></span>
<span><span class="co">#&gt;    ", " inla.call = inla.call, inla.arg = inla.arg, num.threads = </span></span>
<span><span class="co">#&gt;    num.threads, ", " keep = keep, working.directory = working.directory, </span></span>
<span><span class="co">#&gt;    silent = silent, ", " inla.mode = inla.mode, safe = FALSE, debug = </span></span>
<span><span class="co">#&gt;    debug, .parent.frame = .parent.frame)" ) </span></span>
<span><span class="co">#&gt; Time used:</span></span>
<span><span class="co">#&gt;     Pre = 0.223, Running = 0.307, Post = 0.0142, Total = 0.544 </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;              mean    sd 0.025quant 0.5quant 0.975quant  mode kld</span></span>
<span><span class="co">#&gt; (Intercept) 1.925 0.478      0.987    1.925      2.865 1.925   0</span></span>
<span><span class="co">#&gt; Real.rich   0.330 0.126      0.083    0.330      0.578 0.330   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;   Name     Model</span></span>
<span><span class="co">#&gt;     comm Generic0 model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters:</span></span>
<span><span class="co">#&gt;                                          mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 2.430 0.401      1.725     2.40</span></span>
<span><span class="co">#&gt; Precision for comm                      0.511 0.158      0.264     0.49</span></span>
<span><span class="co">#&gt;                                         0.975quant  mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations      3.299 2.352</span></span>
<span><span class="co">#&gt; Precision for comm                           0.881 0.452</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Marginal log-Likelihood:  -696.39 </span></span>
<span><span class="co">#&gt;  is computed </span></span>
<span><span class="co">#&gt; Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">#&gt; (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_m</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;    c("inla.core(formula = formula, family = family, contrasts = contrasts, </span></span>
<span><span class="co">#&gt;    ", " data = data, quantiles = quantiles, E = E, offset = offset, ", " </span></span>
<span><span class="co">#&gt;    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, </span></span>
<span><span class="co">#&gt;    ", " lp.scale = lp.scale, link.covariates = link.covariates, verbose = </span></span>
<span><span class="co">#&gt;    verbose, ", " lincomb = lincomb, selection = selection, control.compute </span></span>
<span><span class="co">#&gt;    = control.compute, ", " control.predictor = control.predictor, </span></span>
<span><span class="co">#&gt;    control.family = control.family, ", " control.inla = control.inla, </span></span>
<span><span class="co">#&gt;    control.fixed = control.fixed, ", " control.mode = control.mode, </span></span>
<span><span class="co">#&gt;    control.expert = control.expert, ", " control.hazard = control.hazard, </span></span>
<span><span class="co">#&gt;    control.lincomb = control.lincomb, ", " control.update = </span></span>
<span><span class="co">#&gt;    control.update, control.lp.scale = control.lp.scale, ", " </span></span>
<span><span class="co">#&gt;    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, </span></span>
<span><span class="co">#&gt;    ", " inla.call = inla.call, inla.arg = inla.arg, num.threads = </span></span>
<span><span class="co">#&gt;    num.threads, ", " keep = keep, working.directory = working.directory, </span></span>
<span><span class="co">#&gt;    silent = silent, ", " inla.mode = inla.mode, safe = FALSE, debug = </span></span>
<span><span class="co">#&gt;    debug, .parent.frame = .parent.frame)" ) </span></span>
<span><span class="co">#&gt; Time used:</span></span>
<span><span class="co">#&gt;     Pre = 0.184, Running = 0.261, Post = 0.00939, Total = 0.455 </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;              mean    sd 0.025quant 0.5quant 0.975quant  mode kld</span></span>
<span><span class="co">#&gt; (Intercept) 2.151 0.378      1.408    2.151      2.893 2.151   0</span></span>
<span><span class="co">#&gt; Real.rich   0.138 0.171     -0.199    0.138      0.474 0.138   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters:</span></span>
<span><span class="co">#&gt;                                          mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.324 0.049      0.235    0.321</span></span>
<span><span class="co">#&gt;                                         0.975quant  mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations      0.426 0.317</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Marginal log-Likelihood:  -192.46 </span></span>
<span><span class="co">#&gt;  is computed </span></span>
<span><span class="co">#&gt; Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">#&gt; (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="empirical-analyses---multiple-functions">Empirical analyses - Multiple functions<a class="anchor" aria-label="anchor" href="#empirical-analyses---multiple-functions"></a>
</h2>
<p>In my case, I used lapply to analyze all ecosystem function. So the
codes are more complicated. Let’s define a function for the analysis
first.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_empiricial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ef_data</span>,<span class="va">x</span>,<span class="va">VCV_sp</span>,<span class="va">names</span>,<span class="va">ef_properties</span>,<span class="va">comm</span>,<span class="va">family</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ef_properties</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">ef_data</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,x<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>,</span>
<span>           family <span class="op">=</span> <span class="va">family</span>,</span>
<span>           data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">m_sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">sdres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">sdres</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span>  <span class="va">prior1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior<span class="op">=</span><span class="st">"pc.prec"</span><span class="op">)</span>,param<span class="op">=</span><span class="va">param</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ML.opt2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                 <span class="va">likelihood.lambda.INLA</span>,</span>
<span>                 inla_formula <span class="op">=</span> <span class="va">f</span>,</span>
<span>                 family <span class="op">=</span> <span class="va">family</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                 phyV <span class="op">=</span> <span class="va">VCV_sp</span>,</span>
<span>                 comm <span class="op">=</span> <span class="va">KSR</span>,</span>
<span>                 prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior1 <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span>,</span>
<span>                 control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>                 lower <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>                 upper <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>                 control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>factr<span class="op">=</span><span class="fl">1e9</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lambda_INLA</span><span class="op">&lt;-</span><span class="va">ML.opt2</span><span class="op">$</span><span class="va">par</span></span>
<span>  <span class="va">wAIC</span> <span class="op">&lt;-</span> <span class="va">ML.opt2</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">V_INLA</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">*</span><span class="va">lambda_INLA</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">V_INLA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span></span>
<span>  <span class="va">C.lambda.INLA</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">comm</span>,<span class="va">V_INLA</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">newobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="cn">NA</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,comm<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="va">INLA_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">newobs</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">m2_INLA_LM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>,</span>
<span>                     data<span class="op">=</span><span class="va">INLA_df</span>,</span>
<span>                     family<span class="op">=</span><span class="va">family</span>,</span>
<span>                     control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">T</span>,waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_LM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/rerun.html" class="external-link">inla.rerun</a></span><span class="op">(</span><span class="va">m2_INLA_LM</span><span class="op">)</span></span>
<span>  <span class="va">wAIC_LM</span> <span class="op">&lt;-</span> <span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">waic</span><span class="op">$</span><span class="va">waic</span></span>
<span>  <span class="va">m2_INLA_LM_r2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="st">"mean"</span><span class="op">]</span>,<span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">prec.mat.INLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">C.lambda.INLA</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">comm</span>,</span>
<span>                              model<span class="op">=</span><span class="st">"generic0"</span>,</span>
<span>                              Cmatrix<span class="op">=</span><span class="va">prec.mat.INLA</span>,</span>
<span>                              prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                              hyper<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        family <span class="op">=</span> <span class="va">family</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">INLA_df</span>,control.predictor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                        control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">T</span>,waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>                        safe<span class="op">=</span><span class="cn">T</span>,</span>
<span>                        control.inla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">1e-10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/rerun.html" class="external-link">inla.rerun</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">)</span> <span class="co"># https://groups.google.com/g/r-inla-discussion-group/c/qkoV9ZtA1Wo</span></span>
<span>  <span class="va">m2_INLA_optim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/rerun.html" class="external-link">inla.rerun</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">)</span> <span class="co"># https://groups.google.com/g/r-inla-discussion-group/c/qkoV9ZtA1Wo</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">family</span> <span class="op">==</span> <span class="st">"poisson"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">m2_INLA_optim_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">m2_INLA_optim_predict</span> <span class="op">&lt;-</span> <span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">m2_INLA_optim_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">newobs</span><span class="op">$</span><span class="va">x</span>,<span class="va">m2_INLA_optim_predict</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>,<span class="st">"0.025quant"</span>,<span class="st">"0.975quant"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim_predict</span><span class="op">$</span><span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span>     <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,<span class="st">"mean"</span><span class="op">]</span>,<span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/" class="external-link">ggeffects</a></span><span class="op">)</span></span>
<span>  <span class="va">m_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://strengejacke.github.io/ggeffects/reference/ggpredict.html" class="external-link">ggeffect</a></span><span class="op">(</span><span class="va">m</span>,terms<span class="op">=</span><span class="st">"x"</span><span class="op">)</span>,sig<span class="op">=</span><span class="va">m_sig</span><span class="op">)</span></span>
<span>  <span class="va">m_predict</span> <span class="op">&lt;-</span> <span class="va">m_predict</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m2_INLA_optim_predict</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m_predict</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">###summarize the data into a dataframe</span></span>
<span>  <span class="va">predict_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m_predict</span>,</span>
<span>                            model<span class="op">=</span><span class="st">"LM/GLM"</span>,</span>
<span>                            ef<span class="op">=</span><span class="va">ef_properties</span>,</span>
<span>                            lambda<span class="op">=</span><span class="cn">NA</span>,</span>
<span>                            hyper_Gaussian <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                            hyper_Comm <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                            wAIC <span class="op">=</span> <span class="va">wAIC_LM</span>,</span>
<span>                            r2<span class="op">=</span><span class="va">m2_INLA_LM_r2</span>,</span>
<span>                            mean<span class="op">=</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            lower_quant<span class="op">=</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                            upper_quant<span class="op">=</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m2_INLA_optim_predict</span>,</span>
<span>                            model<span class="op">=</span><span class="st">"Optimized INLA"</span>,</span>
<span>                            ef<span class="op">=</span><span class="va">ef_properties</span>,</span>
<span>                            lambda<span class="op">=</span><span class="va">lambda_INLA</span>,</span>
<span>                            hyper_Gaussian<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.hyperpar</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            hyper_Comm <span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.hyperpar</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            wAIC<span class="op">=</span><span class="va">wAIC</span>,</span>
<span>                            r2<span class="op">=</span><span class="va">m2_INLA_optim_r2</span>,</span>
<span>                            mean<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            lower_quant<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                            upper_quant<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">predict_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now let’s run it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ef_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"litter2012"</span>,<span class="st">"ave.biomass"</span>,<span class="st">"LAI"</span>,<span class="st">"bug.rich"</span>,<span class="st">"bugs"</span>,<span class="st">"poll_total"</span>,<span class="st">"log_flwr_total"</span>,<span class="st">"Mass.loss.2month"</span>,<span class="st">"Damage_effect"</span>,<span class="st">"mean.N.change"</span><span class="op">)</span> <span class="co">#ecosystem functions analyzed</span></span>
<span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="va">KSR_EF</span><span class="op">[</span>,<span class="va">ef_name</span><span class="op">]</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">comm</span>,model<span class="op">=</span><span class="st">"generic0"</span>,Cmatrix<span class="op">=</span><span class="va">P.lambda</span>,hyper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ef_name</span> <span class="op">==</span> <span class="st">"bug.rich"</span> <span class="op">|</span> <span class="va">ef_name</span> <span class="op">==</span> <span class="st">"bugs"</span> <span class="op">|</span> <span class="va">ef_name</span> <span class="op">==</span> <span class="st">"poll_total"</span>,</span>
<span>                 <span class="st">"poisson"</span>,</span>
<span>                 <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">Real.rich</span><span class="op">)</span> <span class="co">#seems that ggeffect can only extract variables from global environments</span></span>
<span><span class="va">predict_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ef</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">ef_empiricial</span><span class="op">(</span>ef_data<span class="op">=</span><span class="va">ef</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span>,</span>
<span>                                                          x<span class="op">=</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">Real.rich</span>,</span>
<span>                                                          VCV_sp<span class="op">=</span><span class="va">VCV_sp</span>,</span>
<span>                                                          ef_properties<span class="op">=</span><span class="va">ef_name</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>,</span>
<span>                                                          comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>                                                          family<span class="op">=</span><span class="va">family</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "litter2012"</span></span>
<span><span class="co">#&gt; [1] "ave.biomass"</span></span>
<span><span class="co">#&gt; [1] "LAI"</span></span>
<span><span class="co">#&gt; [1] "bug.rich"</span></span>
<span><span class="co">#&gt; [1] "bugs"</span></span>
<span><span class="co">#&gt; [1] "poll_total"</span></span>
<span><span class="co">#&gt; [1] "log_flwr_total"</span></span>
<span><span class="co">#&gt; [1] "Mass.loss.2month"</span></span>
<span><span class="co">#&gt; [1] "Damage_effect"</span></span>
<span><span class="co">#&gt; [1] "mean.N.change"</span></span>
<span></span>
<span><span class="va">predict_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">predict_df</span><span class="op">)</span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">predict_df</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">sig_binary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">predict_df</span><span class="op">$</span><span class="va">sig</span> <span class="op">&lt;</span> <span class="fl">0.05</span>,<span class="st">"Significant"</span>,<span class="st">"Insignificant"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-visualization">Data visualization<a class="anchor" aria-label="anchor" href="#data-visualization"></a>
</h2>
<p>Now let’s visualize the findings</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">KSR_EF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">ef_name</span><span class="op">)</span><span class="op">|</span><span class="st">"Real.rich"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">Real.rich</span>,names_to<span class="op">=</span><span class="st">"ef"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span><span class="op">$</span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">ef</span>,</span>
<span>                            <span class="st">"litter2012"</span>,</span>
<span>                            <span class="st">"ave.biomass"</span>,</span>
<span>                            <span class="st">"LAI"</span>,</span>
<span>                            <span class="st">"poll_total"</span>,</span>
<span>                            <span class="st">"log_flwr_total"</span>,</span>
<span>                            <span class="st">"Mass.loss.2month"</span>,</span>
<span>                            <span class="st">"Damage_effect"</span>,</span>
<span>                            <span class="st">"mean.N.change"</span>,</span>
<span>                            <span class="st">"bugs"</span>,</span>
<span>                            <span class="st">"bug.rich"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">predict_df</span><span class="op">$</span><span class="va">ef</span>,</span>
<span>                             <span class="st">"litter2012"</span>,</span>
<span>                             <span class="st">"ave.biomass"</span>,</span>
<span>                             <span class="st">"LAI"</span>,</span>
<span>                             <span class="st">"poll_total"</span>,</span>
<span>                             <span class="st">"log_flwr_total"</span>,</span>
<span>                             <span class="st">"Mass.loss.2month"</span>,</span>
<span>                             <span class="st">"Damage_effect"</span>,</span>
<span>                             <span class="st">"mean.N.change"</span>,</span>
<span>                             <span class="st">"bugs"</span>,</span>
<span>                             <span class="st">"bug.rich"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Gaussian</span><span class="op">/</span><span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Comm</span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Gaussian</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Comm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">predict_df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">value</span>,x<span class="op">=</span><span class="va">Real.rich</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">predicted</span>,x<span class="op">=</span><span class="va">x</span>,colour<span class="op">=</span><span class="va">model</span>,linetype<span class="op">=</span><span class="va">sig_binary</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">predicted</span>,x<span class="op">=</span><span class="va">x</span>,fill<span class="op">=</span><span class="va">model</span>,ymin<span class="op">=</span><span class="va">conf.low</span>,ymax<span class="op">=</span><span class="va">conf.high</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.3</span>,colour<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ef</span>,scales<span class="op">=</span><span class="st">"free"</span>,nrow<span class="op">=</span><span class="fl">5</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Species richness"</span>,y<span class="op">=</span><span class="st">"Ecosystem Function"</span>,colour<span class="op">=</span><span class="st">"Model"</span>,fill<span class="op">=</span><span class="st">"Model"</span>,linetype<span class="op">=</span><span class="st">"Significance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>,<span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>,<span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="Empirical_files/figure-html/unnamed-chunk-5-1.png" width="960cm"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Toby Pak Nok Tsang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
