<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CPR">
<title>Empirical Analyses with CPR • CPR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Analyses with CPR">
<meta property="og:description" content="CPR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CPR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Empirical.html">Empirical Analyses with CPR</a>
    <a class="dropdown-item" href="../articles/Simulation.html">Simulation with CPR</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tpaknok/CPR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Empirical Analyses with CPR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tpaknok/CPR/blob/HEAD/vignettes/Empirical.Rmd" class="external-link"><code>vignettes/Empirical.Rmd</code></a></small>
      <div class="d-none name"><code>Empirical.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>This is an R Markdown document describing the empirical analyses
conducted in Tsang et al. (2024). Again, you will need to install and
load multiple packages and data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ape</span></span>
<span><span class="co">#&gt; Loading required package: maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">purrr</span>::<span style="color: #00BB00;">map()</span>    masks <span style="color: #0000BB;">maps</span>::map()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">where()</span>  masks <span style="color: #0000BB;">ape</span>::where()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tpaknok/CPR" class="external-link">CPR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR_MLtree"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR_EF"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s get the variane covariance matrix at species and community
level.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span> <span class="co">#species level phyologenetic covariance matrix using default (Brownian) model</span></span>
<span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">VCV_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">VCV_comm</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.7031681 0.5639611 0.5601336 0.7539047 0.4601492 0.9925155</span></span>
<span><span class="co">#&gt; [2,] 0.7031681 1.0000000 0.5458038 0.5420995 0.7048548 0.8307885 0.7029687</span></span>
<span><span class="co">#&gt; [3,] 0.5639611 0.5458038 1.0000000 0.9932127 0.5749535 0.4632934 0.5682136</span></span>
<span><span class="co">#&gt; [4,] 0.5601336 0.5420995 0.9932127 1.0000000 0.5710514 0.4601492 0.5643572</span></span>
<span><span class="co">#&gt; [5,] 0.7539047 0.7048548 0.5749535 0.5710514 1.0000000 0.4533837 0.7669912</span></span>
<span><span class="co">#&gt; [6,] 0.4601492 0.8307885 0.4632934 0.4601492 0.4533837 1.0000000 0.4636189</span></span>
<span><span class="co">#&gt;           [,8]      [,9]     [,10]     [,11]     [,12]     [,13]     [,14]</span></span>
<span><span class="co">#&gt; [1,] 0.8712603 0.9701756 0.5601336 0.8663298 0.5420995 0.5153010 0.5601336</span></span>
<span><span class="co">#&gt; [2,] 0.8684921 0.6922472 0.5420995 0.6987812 0.8788514 0.7925793 0.5420995</span></span>
<span><span class="co">#&gt; [3,] 0.5704436 0.5639611 0.9923060 0.8815382 0.7029856 0.7351607 0.5774421</span></span>
<span><span class="co">#&gt; [4,] 0.5665721 0.5601336 0.9729443 0.8678972 0.7031681 0.7237939 0.5735231</span></span>
<span><span class="co">#&gt; [5,] 0.8849584 0.7685974 0.5710514 0.7583943 0.7215389 0.7662137 0.5584944</span></span>
<span><span class="co">#&gt; [6,] 0.6198276 0.4601491 0.4601491 0.5209940 0.8307885 0.6408264 0.4601491</span></span>
<span><span class="co">#&gt;          [,15]     [,16]     [,17]     [,18]     [,19]     [,20]     [,21]</span></span>
<span><span class="co">#&gt; [1,] 0.5970448 0.3960743 0.2543210 0.7657384 0.3960743 0.3960743 0.3960743</span></span>
<span><span class="co">#&gt; [2,] 0.8033808 0.5221971 0.5662499 0.9153189 0.6229403 0.5221971 0.6422480</span></span>
<span><span class="co">#&gt; [3,] 0.8523121 0.7023074 0.4509546 0.6179478 0.4264597 0.7023074 0.4264597</span></span>
<span><span class="co">#&gt; [4,] 0.8544437 0.6879755 0.4540360 0.6137539 0.4235654 0.7071064 0.4235654</span></span>
<span><span class="co">#&gt; [5,] 0.5994746 0.7397579 0.4992199 0.8490617 0.7303207 0.7521494 0.7303207</span></span>
<span><span class="co">#&gt; [6,] 0.8544437 0.3253746 0.2089244 0.7278418 0.3253746 0.3253746 0.3253746</span></span>
<span><span class="co">#&gt;          [,22]     [,23]         [,24]     [,25]         [,26]     [,27]</span></span>
<span><span class="co">#&gt; [1,] 0.7691076 0.5601336 -6.765456e-10 0.8663298  1.703868e-11 0.9701756</span></span>
<span><span class="co">#&gt; [2,] 0.7883054 0.5420995  1.963987e-01 0.6987812  1.963987e-01 0.6922472</span></span>
<span><span class="co">#&gt; [3,] 0.6418327 0.9923060  5.999162e-09 0.6461646  6.089212e-09 0.5639611</span></span>
<span><span class="co">#&gt; [4,] 0.6374767 0.9729443  1.115908e-08 0.6417792 -1.120003e-09 0.5601336</span></span>
<span><span class="co">#&gt; [5,] 0.8682531 0.5710514  4.926484e-01 0.7512856  4.751242e-01 0.7685974</span></span>
<span><span class="co">#&gt; [6,] 0.5078889 0.4601491  1.166571e-08 0.5209940 -1.758360e-09 0.4601491</span></span>
<span><span class="co">#&gt;          [,28]     [,29]     [,30]     [,31]     [,32]        [,33]     [,34]</span></span>
<span><span class="co">#&gt; [1,] 0.3960743 0.4435877 0.8070638 0.5970448 0.5420995 2.631579e-09 0.5601336</span></span>
<span><span class="co">#&gt; [2,] 0.5221971 0.6943513 0.7322816 0.8033809 0.8788514 3.388711e-01 0.5420995</span></span>
<span><span class="co">#&gt; [3,] 0.7016663 0.3925180 0.7672965 0.6240306 0.7029856 3.359856e-09 0.9932127</span></span>
<span><span class="co">#&gt; [4,] 0.6879755 0.3898540 0.7571955 0.6197954 0.7031681 4.839762e-09 0.9999995</span></span>
<span><span class="co">#&gt; [5,] 0.7521494 0.7803836 0.8811774 0.7150738 0.7215389 2.642320e-01 0.5710514</span></span>
<span><span class="co">#&gt; [6,] 0.3253746 0.4848210 0.4993612 0.7424827 0.8307885 1.996862e-09 0.4601492</span></span>
<span><span class="co">#&gt;          [,35]        [,36]     [,37]     [,38]     [,39]     [,40]     [,41]</span></span>
<span><span class="co">#&gt; [1,] 0.9701756 2.631579e-09 0.4955117 0.3253746 0.5601336 0.5601336 0.5601336</span></span>
<span><span class="co">#&gt; [2,] 0.6922472 3.388711e-01 0.5586088 0.7263311 0.5420995 0.5420995 0.5420995</span></span>
<span><span class="co">#&gt; [3,] 0.5639611 3.359857e-09 0.3987807 0.3275979 0.9932127 0.5774421 0.9932127</span></span>
<span><span class="co">#&gt; [4,] 0.5601336 4.839763e-09 0.3960743 0.3253746 0.9999995 0.5735231 0.9729443</span></span>
<span><span class="co">#&gt; [5,] 0.7685974 2.642320e-01 0.7752022 0.6689457 0.5710514 0.5584944 0.5710514</span></span>
<span><span class="co">#&gt; [6,] 0.4601491 1.996862e-09 0.3253746 0.7071064 0.4601492 0.4601491 0.4601491</span></span>
<span><span class="co">#&gt;             [,42]     [,43]     [,44]         [,45]     [,46]         [,47]</span></span>
<span><span class="co">#&gt; [1,] 1.672847e-09 0.8369914 0.9999995 -6.765455e-10 0.7007594  1.703856e-11</span></span>
<span><span class="co">#&gt; [2,] 3.661764e-01 0.8912437 0.7031681  1.963987e-01 0.5935934  1.963987e-01</span></span>
<span><span class="co">#&gt; [3,] 6.933521e-09 0.6011245 0.5639611  5.999162e-09 0.5639611  6.089211e-09</span></span>
<span><span class="co">#&gt; [4,] 1.337880e-08 0.5970448 0.5601336  1.115908e-08 0.5601336 -1.120003e-09</span></span>
<span><span class="co">#&gt; [5,] 2.642320e-01 0.7150738 0.7539047  4.926484e-01 0.6211772  4.751242e-01</span></span>
<span><span class="co">#&gt; [6,] 1.771247e-09 0.7424827 0.4601492  1.166571e-08 0.4601492 -1.758360e-09</span></span>
<span><span class="co">#&gt;          [,48]     [,49]     [,50]     [,51]     [,52]     [,53]     [,54]</span></span>
<span><span class="co">#&gt; [1,] 0.6018607 0.5420995 0.5970448 0.6314951 0.5601336 0.6149358 0.3960743</span></span>
<span><span class="co">#&gt; [2,] 0.6908618 0.8788514 0.8033808 0.6111635 0.5420995 0.7110985 0.6422480</span></span>
<span><span class="co">#&gt; [3,] 0.9677978 0.7029856 0.6090133 0.8853788 0.6031051 0.6257310 0.7023074</span></span>
<span><span class="co">#&gt; [4,] 0.9576792 0.7031681 0.6048800 0.8717444 0.5990119 0.6160484 0.7071064</span></span>
<span><span class="co">#&gt; [5,] 0.6091678 0.7215389 0.5921266 0.6367255 0.7685974 0.8424643 0.5906346</span></span>
<span><span class="co">#&gt; [6,] 0.6155167 0.8307885 0.8544437 0.5187726 0.4601492 0.3698105 0.3253746</span></span>
<span><span class="co">#&gt;          [,55]     [,56]     [,57]     [,58]     [,59]     [,60]     [,61]</span></span>
<span><span class="co">#&gt; [1,] 0.3960743 0.3253746 0.4601491 0.5601336 0.7539047 0.9925155 0.5601336</span></span>
<span><span class="co">#&gt; [2,] 0.6422480 0.7263311 0.8307885 0.5420995 0.7750436 0.7029687 0.5420995</span></span>
<span><span class="co">#&gt; [3,] 0.4083132 0.3275979 0.4632934 0.5774421 0.5623107 0.5682136 0.9932127</span></span>
<span><span class="co">#&gt; [4,] 0.4055421 0.3253746 0.4601491 0.5735231 0.5584944 0.5643572 0.9729443</span></span>
<span><span class="co">#&gt; [5,] 0.5817554 0.6689457 0.4533837 0.5584944 0.7839635 0.7669912 0.5710514</span></span>
<span><span class="co">#&gt; [6,] 0.3253746 0.5718166 0.8086708 0.4601491 0.4533837 0.4636189 0.4601491</span></span>
<span><span class="co">#&gt;          [,62]     [,63]        [,64]     [,65]        [,66]     [,67]</span></span>
<span><span class="co">#&gt; [1,] 0.4601491 0.9999995 1.510981e-09 0.7918954 1.672848e-09 0.7007594</span></span>
<span><span class="co">#&gt; [2,] 0.8307885 0.7031681 3.053604e-01 0.9225925 3.661764e-01 0.5935934</span></span>
<span><span class="co">#&gt; [3,] 0.4632934 0.5639611 5.390498e-09 0.5912842 6.933521e-09 0.5639611</span></span>
<span><span class="co">#&gt; [4,] 0.4601491 0.5601336 2.122046e-09 0.5872712 1.337880e-08 0.5601336</span></span>
<span><span class="co">#&gt; [5,] 0.4533837 0.7539047 4.217875e-01 0.7830910 2.642320e-01 0.6211772</span></span>
<span><span class="co">#&gt; [6,] 0.8086708 0.4601492 1.360604e-10 0.7135687 1.771248e-09 0.4601492</span></span>
<span><span class="co">#&gt;          [,68]         [,69]     [,70]     [,71]     [,72]     [,73]     [,74]</span></span>
<span><span class="co">#&gt; [1,] 0.6676854 -6.765456e-10 0.5601336 0.9701756 0.4601491 0.9701756 0.9442445</span></span>
<span><span class="co">#&gt; [2,] 0.7494278  1.963987e-01 0.5420995 0.6922472 0.8307885 0.6922472 0.7230294</span></span>
<span><span class="co">#&gt; [3,] 0.7920733  5.999162e-09 0.9932127 0.5639611 0.4632934 0.5639611 0.6363970</span></span>
<span><span class="co">#&gt; [4,] 0.7817377  1.115908e-08 0.9729443 0.5601336 0.4601491 0.5601336 0.6320778</span></span>
<span><span class="co">#&gt; [5,] 0.8158248  4.926484e-01 0.5710514 0.7685974 0.4533837 0.7685974 0.7765730</span></span>
<span><span class="co">#&gt; [6,] 0.5061456  1.166571e-08 0.4601491 0.4601491 0.8086708 0.4601491 0.5151466</span></span>
<span><span class="co">#&gt;             [,75]     [,76]     [,77]     [,78]         [,79]     [,80]</span></span>
<span><span class="co">#&gt; [1,] 1.672847e-09 0.4601492 0.5601336 0.9040524  1.703854e-11 0.5601336</span></span>
<span><span class="co">#&gt; [2,] 3.661764e-01 0.8307885 0.5420995 0.8368924  1.963987e-01 0.5420995</span></span>
<span><span class="co">#&gt; [3,] 6.933521e-09 0.4632934 0.9923060 0.7813047  6.089212e-09 0.6031051</span></span>
<span><span class="co">#&gt; [4,] 1.337880e-08 0.4601492 0.9729443 0.7800917 -1.120003e-09 0.5990119</span></span>
<span><span class="co">#&gt; [5,] 2.642320e-01 0.4533837 0.5710514 0.7699707  4.751242e-01 0.7685974</span></span>
<span><span class="co">#&gt; [6,] 1.771248e-09 0.9999995 0.4601491 0.7196386 -1.758360e-09 0.4601492</span></span>
<span><span class="co">#&gt;          [,81]     [,82]     [,83]     [,84]     [,85]     [,86]     [,87]</span></span>
<span><span class="co">#&gt; [1,] 0.8663298 0.4601492 0.4838757 0.9701756 0.9925155 0.8369914 0.5601336</span></span>
<span><span class="co">#&gt; [2,] 0.6987812 0.8307885 0.8736263 0.6922472 0.7029687 0.8912437 0.5420995</span></span>
<span><span class="co">#&gt; [3,] 0.6461646 0.4632934 0.4871821 0.5639611 0.5682136 0.6011245 0.9923060</span></span>
<span><span class="co">#&gt; [4,] 0.6417792 0.4601492 0.4838757 0.5601336 0.5643572 0.5970448 0.9729443</span></span>
<span><span class="co">#&gt; [5,] 0.7512856 0.4533837 0.4767614 0.7685974 0.7669912 0.7150738 0.5710514</span></span>
<span><span class="co">#&gt; [6,] 0.5209940 0.9999995 0.9509651 0.4601491 0.4636189 0.7424827 0.4601491</span></span>
<span><span class="co">#&gt;          [,88]</span></span>
<span><span class="co">#&gt; [1,] 0.7918954</span></span>
<span><span class="co">#&gt; [2,] 0.8595044</span></span>
<span><span class="co">#&gt; [3,] 0.5912842</span></span>
<span><span class="co">#&gt; [4,] 0.5872712</span></span>
<span><span class="co">#&gt; [5,] 0.8679689</span></span>
<span><span class="co">#&gt; [6,] 0.7135687</span></span></code></pre></div>
<p>The KSR_EF data have multiple ecosystem function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Plot Real.rich Legume       Hed       PD     MNND      MPD         H</span></span>
<span><span class="co">#&gt; 1   X2         1      N 0.0000000   0.0000   0.0000   0.0000 0.0000000</span></span>
<span><span class="co">#&gt; 2   X3         4     LP 1.3772918 456.7786 136.7786 258.9262 1.1761865</span></span>
<span><span class="co">#&gt; 3   X4         2      N 0.6931472 320.0000 320.0000 320.0000 0.2249718</span></span>
<span><span class="co">#&gt; 4   X7         1      N 0.0000000   0.0000   0.0000   0.0000 0.0000000</span></span>
<span><span class="co">#&gt; 5   X8         3     LP 1.0934269 418.9892 238.6522 279.3261 0.7560967</span></span>
<span><span class="co">#&gt; 6   X9         1      N 0.0000000   0.0000   0.0000   0.0000 0.0000000</span></span>
<span><span class="co">#&gt;        Simp biomass2012 litter2012 biomass2013 biomass2014 ave.biomass</span></span>
<span><span class="co">#&gt; 1 0.0000000       47.89      79.05       35.39       15.64    32.97333</span></span>
<span><span class="co">#&gt; 2 0.6712373      122.24      74.23       74.33       50.66    82.41000</span></span>
<span><span class="co">#&gt; 3 0.1115254       77.93      34.50       59.62       51.23    62.92667</span></span>
<span><span class="co">#&gt; 4 0.0000000       44.37      36.32       44.69       14.09    34.38333</span></span>
<span><span class="co">#&gt; 5 0.5120332      166.82      21.46      148.84      125.51   147.05667</span></span>
<span><span class="co">#&gt; 6 0.0000000       44.37      37.26       32.12       24.92    33.80333</span></span>
<span><span class="co">#&gt;   Light.tau  LAI C.change.deep C.change.surf N.change.deep N.change.surf</span></span>
<span><span class="co">#&gt; 1     0.312 1.67        -0.331        -0.031         0.007        -0.010</span></span>
<span><span class="co">#&gt; 2     0.031 5.53         1.762         0.111        -0.046        -0.009</span></span>
<span><span class="co">#&gt; 3     0.100 3.04        -0.518         0.421        -0.012         0.024</span></span>
<span><span class="co">#&gt; 4     0.083 3.42        -0.156        -0.009        -0.087        -0.028</span></span>
<span><span class="co">#&gt; 5     0.006 7.14            NA            NA        -0.045         0.031</span></span>
<span><span class="co">#&gt; 6     0.499 1.01        -1.895        -0.128         0.066         0.017</span></span>
<span><span class="co">#&gt;   mean.N.change poll_total flwr_total Mass.loss.1month Mass.loss.2month</span></span>
<span><span class="co">#&gt; 1       -0.0015         20 43113.5000            2.891            3.362</span></span>
<span><span class="co">#&gt; 2       -0.0275         53  2126.1429            3.147            3.718</span></span>
<span><span class="co">#&gt; 3        0.0060        150   324.4286            2.972            3.521</span></span>
<span><span class="co">#&gt; 4       -0.0575          0     0.0000            2.714            3.328</span></span>
<span><span class="co">#&gt; 5       -0.0070          0     0.0000            3.283            3.608</span></span>
<span><span class="co">#&gt; 6        0.0415          0     0.0000            3.020            3.627</span></span>
<span><span class="co">#&gt;         GRASS SOAL       MOFI ASTU       DECA Damage_effect bugs bug.rich</span></span>
<span><span class="co">#&gt; 1          NA   NA         NA   NA         NA     0.0000000    9        7</span></span>
<span><span class="co">#&gt; 2 -0.34584386   NA         NA   NA 0.04572438    -0.3001195    7        6</span></span>
<span><span class="co">#&gt; 3 -0.04241343   NA -0.3771144   NA         NA    -0.4195279    4        2</span></span>
<span><span class="co">#&gt; 4          NA   NA         NA   NA         NA     0.0000000    5        3</span></span>
<span><span class="co">#&gt; 5 -2.74600928   NA         NA   NA         NA    -2.7460093    4        4</span></span>
<span><span class="co">#&gt; 6          NA   NA         NA   NA         NA     0.0000000   11        7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<table class="table">
<colgroup>
<col width="23%">
<col width="76%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Plot</td>
<td>Plot identity</td>
</tr>
<tr class="even">
<td>Real.rich</td>
<td>Number of species planted</td>
</tr>
<tr class="odd">
<td>Legume</td>
<td>?</td>
</tr>
<tr class="even">
<td>Hed</td>
<td>?</td>
</tr>
<tr class="odd">
<td>PD</td>
<td>?</td>
</tr>
<tr class="even">
<td>MNND</td>
<td>?</td>
</tr>
<tr class="odd">
<td>MPD</td>
<td>?</td>
</tr>
<tr class="even">
<td>H</td>
<td>?</td>
</tr>
<tr class="odd">
<td>Simp</td>
<td>?</td>
</tr>
<tr class="even">
<td>biomass2012</td>
<td>Biomass measured in 2012</td>
</tr>
<tr class="odd">
<td>litter2012</td>
<td>Amount of litter measured in 2012</td>
</tr>
<tr class="even">
<td>biomass2013</td>
<td>Biomass measured in 2013</td>
</tr>
<tr class="odd">
<td>biomass2014</td>
<td>Biomass measured in 2014</td>
</tr>
<tr class="even">
<td>ave.biomass</td>
<td>Average biomass across years</td>
</tr>
<tr class="odd">
<td>light.tau</td>
<td>?</td>
</tr>
<tr class="even">
<td>LAI</td>
<td>Leaf area index, a simplified dimension of structural
complexity</td>
</tr>
<tr class="odd">
<td>C.change.deep</td>
<td>?</td>
</tr>
<tr class="even">
<td>C.change.surf</td>
<td>?</td>
</tr>
<tr class="odd">
<td>N.change.deep</td>
<td>delta 15N change of deep soil</td>
</tr>
<tr class="even">
<td>N.change.surf</td>
<td>delta 15N change of surface soil</td>
</tr>
<tr class="odd">
<td>mean.N.change</td>
<td>delta 15N change averaged across surface and deep soil</td>
</tr>
<tr class="even">
<td>poll_total</td>
<td>Total number of pollinators</td>
</tr>
<tr class="odd">
<td>flwr_total</td>
<td>Total number of flowers</td>
</tr>
<tr class="even">
<td>Mass.loss.1month</td>
<td>Decomposition after 1 month</td>
</tr>
<tr class="odd">
<td>Mass.loss.2monh</td>
<td>Decomposition after 2 months</td>
</tr>
<tr class="even">
<td>GRASS</td>
<td>?</td>
</tr>
<tr class="odd">
<td>SOAL</td>
<td>?</td>
</tr>
<tr class="even">
<td>MOFI</td>
<td>?</td>
</tr>
<tr class="odd">
<td>ASTU</td>
<td>?</td>
</tr>
<tr class="even">
<td>DECA</td>
<td>?</td>
</tr>
<tr class="odd">
<td>Damage_effect</td>
<td>Damage reduction effect</td>
</tr>
<tr class="even">
<td>bugs</td>
<td>Total number of arthropods</td>
</tr>
<tr class="odd">
<td>bug.rich</td>
<td>Species richness of arthropods</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="empirical-analyses">Empirical analyses<a class="anchor" aria-label="anchor" href="#empirical-analyses"></a>
</h2>
<p>We repeated the analyses in <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.2045?casa_token=dROW6fWW92EAAAAA%3AuXcUC3seoCFkzpoV1Zb6_PSzxjkN7_8H1jhBYjjzTiF0-g3tPsfV1lFQVN4k1QiNRTLwqWbl4PW_nQ" class="external-link">Cadotte
et al. (2017)</a>, involving ten ecosystem functions. If only one
ecosystem function is of interest (or if you don’t mind your code is
clunky), you can just use INLA and write similar functions ten times.
For example…</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">log_flwr_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">flwr_total</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="co">#log-transforming floral abundance to facilitate covnergence in INLA</span></span>
<span></span>
<span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span> <span class="co">#need to create an unique identifier for each comm in INLA</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span>,data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sdres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">sdres</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">prior1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior<span class="op">=</span><span class="st">"pc.prec"</span><span class="op">)</span>,param<span class="op">=</span><span class="va">param</span><span class="op">)</span> <span class="co">#you don't need to follow everything here. You can specify your own prior too.</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu">f</span><span class="op">(</span><span class="va">comm</span>,model<span class="op">=</span><span class="st">"generic0"</span>,Cmatrix<span class="op">=</span><span class="va">P.lambda</span>,hyper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span><span class="op">)</span> <span class="co">#start with the formula. Note that P.lambda is just a placeholder </span></span>
<span><span class="co">#You can also provide multiple prior</span></span>
<span></span>
<span><span class="va">ML.opt2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>               <span class="va">likelihood.lambda.INLA</span>,</span>
<span>               inla_formula<span class="op">=</span> <span class="va">f</span>,</span>
<span>               family<span class="op">=</span><span class="st">"gaussian"</span>,</span>
<span>               data<span class="op">=</span><span class="va">KSR_EF</span>,</span>
<span>               phyV<span class="op">=</span><span class="va">VCV_sp</span>,</span>
<span>               comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior1 <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span>,</span>
<span>               control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>               method<span class="op">=</span><span class="st">"L-BFGS-B"</span>,</span>
<span>               lower<span class="op">=</span><span class="fl">0.0</span>,</span>
<span>               upper<span class="op">=</span><span class="fl">1.0</span>,</span>
<span>               control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>factr<span class="op">=</span><span class="fl">1e9</span><span class="op">)</span><span class="op">)</span> <span class="co">#SLOW</span></span>
<span></span>
<span><span class="va">lambda_INLA</span><span class="op">&lt;-</span><span class="va">ML.opt2</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">wAIC</span> <span class="op">&lt;-</span> <span class="va">ML.opt2</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">VCV_sp_INLA</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">*</span><span class="va">lambda_INLA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VCV_sp_INLA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span></span>
<span><span class="va">C.lambda.INLA</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp_INLA</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">prec.mat.INLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">C.lambda.INLA</span><span class="op">)</span> <span class="co">#note that INLA requires a precision matrix, not a VCV</span></span>
<span></span>
<span><span class="va">optim_m</span> <span class="op">&lt;-</span> <span class="fu">inla</span><span class="op">(</span><span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu">f</span><span class="op">(</span><span class="va">comm</span>,</span>
<span>                                           model<span class="op">=</span><span class="st">"generic0"</span>,</span>
<span>                                           Cmatrix<span class="op">=</span><span class="va">prec.mat.INLA</span>,</span>
<span>                                           hyper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_m</span> <span class="op">&lt;-</span> <span class="fu">inla</span><span class="op">(</span><span class="va">log_flwr_total</span><span class="op">~</span><span class="va">Real.rich</span>,</span>
<span>                data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">optim_m</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_m</span><span class="op">)</span></span></code></pre></div>
<p>In my case, I used lapply to do it. So the coding is more
complicated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span>
<span><span class="va">ef_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"litter2012"</span>,<span class="st">"ave.biomass"</span>,<span class="st">"LAI"</span>,<span class="st">"bug.rich"</span>,<span class="st">"bugs"</span>,<span class="st">"poll_total"</span>,<span class="st">"log_flwr_total"</span>,<span class="st">"Mass.loss.2month"</span>,<span class="st">"Damage_effect"</span>,<span class="st">"mean.N.change"</span><span class="op">)</span> <span class="co">#ecosystem functions analyzed</span></span>
<span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="va">KSR_EF</span><span class="op">[</span>,<span class="va">ef_name</span><span class="op">]</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu">f</span><span class="op">(</span><span class="va">comm</span>,model<span class="op">=</span><span class="st">"generic0"</span>,Cmatrix<span class="op">=</span><span class="va">P.lambda</span>,hyper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ef_name</span> <span class="op">==</span> <span class="st">"bug.rich"</span> <span class="op">|</span> <span class="va">ef_name</span> <span class="op">==</span> <span class="st">"bugs"</span> <span class="op">|</span> <span class="va">ef_name</span> <span class="op">==</span> <span class="st">"poll_total"</span>,</span>
<span>                 <span class="st">"poisson"</span>,</span>
<span>                 <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ef_empiricial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ef_data</span>,<span class="va">x</span>,<span class="va">VCV_sp</span>,<span class="va">names</span>,<span class="va">ef_properties</span>,<span class="va">comm</span>,<span class="va">family</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ef_properties</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">ef_data</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,x<span class="op">=</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">$</span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>,</span>
<span>           family <span class="op">=</span> <span class="va">family</span>,</span>
<span>           data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">m_sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">sdres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="va">sdres</span>,<span class="fl">0.01</span><span class="op">)</span></span>
<span>  <span class="va">prior1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior<span class="op">=</span><span class="st">"pc.prec"</span><span class="op">)</span>,param<span class="op">=</span><span class="va">param</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ML.opt2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                 <span class="va">likelihood.lambda.INLA</span>,</span>
<span>                 inla_formula <span class="op">=</span> <span class="va">f</span>,</span>
<span>                 family <span class="op">=</span> <span class="va">family</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                 phyV <span class="op">=</span> <span class="va">VCV_sp</span>,</span>
<span>                 comm <span class="op">=</span> <span class="va">KSR</span>,</span>
<span>                 prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prior1 <span class="op">=</span> <span class="va">prior1</span><span class="op">)</span>,</span>
<span>                 control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>                 lower <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>                 upper <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>                 control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>factr<span class="op">=</span><span class="fl">1e9</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lambda_INLA</span><span class="op">&lt;-</span><span class="va">ML.opt2</span><span class="op">$</span><span class="va">par</span></span>
<span>  <span class="va">wAIC</span> <span class="op">&lt;-</span> <span class="va">ML.opt2</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">V_INLA</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">*</span><span class="va">lambda_INLA</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">V_INLA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span></span>
<span>  <span class="va">C.lambda.INLA</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_comm_pair.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">comm</span>,<span class="va">V_INLA</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">newobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="cn">NA</span>,x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,comm<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="va">INLA_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">newobs</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">m2_INLA_LM</span> <span class="op">&lt;-</span> <span class="fu">inla</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>,</span>
<span>                     data<span class="op">=</span><span class="va">INLA_df</span>,</span>
<span>                     family<span class="op">=</span><span class="va">family</span>,</span>
<span>                     control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">T</span>,waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_LM</span> <span class="op">&lt;-</span> <span class="fu">inla.rerun</span><span class="op">(</span><span class="va">m2_INLA_LM</span><span class="op">)</span></span>
<span>  <span class="va">wAIC_LM</span> <span class="op">&lt;-</span> <span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">waic</span><span class="op">$</span><span class="va">waic</span></span>
<span>  <span class="va">m2_INLA_LM_r2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="st">"mean"</span><span class="op">]</span>,<span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">prec.mat.INLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">C.lambda.INLA</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim</span> <span class="op">&lt;-</span> <span class="fu">inla</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">+</span><span class="fu">f</span><span class="op">(</span><span class="va">comm</span>,</span>
<span>                              model<span class="op">=</span><span class="st">"generic0"</span>,</span>
<span>                              Cmatrix<span class="op">=</span><span class="va">prec.mat.INLA</span>,</span>
<span>                              prior <span class="op">=</span> <span class="st">"pc.prec"</span>,</span>
<span>                              hyper<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,<span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        family <span class="op">=</span> <span class="va">family</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">INLA_df</span>,control.predictor<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>compute<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                        control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dic<span class="op">=</span><span class="cn">T</span>,waic<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>                        safe<span class="op">=</span><span class="cn">T</span>,</span>
<span>                        control.inla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">1e-10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim</span> <span class="op">&lt;-</span> <span class="fu">inla.rerun</span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">)</span> <span class="co"># https://groups.google.com/g/r-inla-discussion-group/c/qkoV9ZtA1Wo</span></span>
<span>  <span class="va">m2_INLA_optim</span> <span class="op">&lt;-</span> <span class="fu">inla.rerun</span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">)</span> <span class="co"># https://groups.google.com/g/r-inla-discussion-group/c/qkoV9ZtA1Wo</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim_predict</span> <span class="op">&lt;-</span> <span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">m2_INLA_optim_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">newobs</span><span class="op">$</span><span class="va">x</span>,<span class="va">m2_INLA_optim_predict</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>,<span class="st">"0.025quant"</span>,<span class="st">"0.975quant"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim_predict</span><span class="op">$</span><span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">m2_INLA_optim_r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fitted.values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,<span class="st">"mean"</span><span class="op">]</span>,<span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strengejacke.github.io/ggeffects/" class="external-link">ggeffects</a></span><span class="op">)</span></span>
<span>  <span class="va">m_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">ggeffect</span><span class="op">(</span><span class="va">m</span>,terms<span class="op">=</span><span class="st">"x"</span><span class="op">)</span>,sig<span class="op">=</span><span class="va">m_sig</span><span class="op">)</span></span>
<span>  <span class="va">m_predict</span> <span class="op">&lt;-</span> <span class="va">m_predict</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m2_INLA_optim_predict</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">m_predict</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">###summarize the data into a dataframe</span></span>
<span>  <span class="va">predict_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m_predict</span>,</span>
<span>                            model<span class="op">=</span><span class="st">"OLS"</span>,</span>
<span>                            ef<span class="op">=</span><span class="va">ef_properties</span>,</span>
<span>                            lambda<span class="op">=</span><span class="cn">NA</span>,</span>
<span>                            hyper_Gaussian <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                            hyper_Comm <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                            wAIC <span class="op">=</span> <span class="va">wAIC_LM</span>,</span>
<span>                            r2<span class="op">=</span><span class="va">m2_INLA_LM_r2</span>,</span>
<span>                            mean<span class="op">=</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            lower_quant<span class="op">=</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                            upper_quant<span class="op">=</span><span class="va">m2_INLA_LM</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">m2_INLA_optim_predict</span>,</span>
<span>                            model<span class="op">=</span><span class="st">"Optimized INLA"</span>,</span>
<span>                            ef<span class="op">=</span><span class="va">ef_properties</span>,</span>
<span>                            lambda<span class="op">=</span><span class="va">lambda_INLA</span>,</span>
<span>                            hyper_Gaussian<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.hyperpar</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            hyper_Comm <span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.hyperpar</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            wAIC<span class="op">=</span><span class="va">wAIC</span>,</span>
<span>                            r2<span class="op">=</span><span class="va">m2_INLA_optim_r2</span>,</span>
<span>                            mean<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                            lower_quant<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>                            upper_quant<span class="op">=</span><span class="va">m2_INLA_optim</span><span class="op">$</span><span class="va">summary.fixed</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">predict_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">Real.rich</span><span class="op">)</span> <span class="co">#seems that ggeffect can only extract variables from global environments</span></span>
<span><span class="va">predict_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ef</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">ef_empiricial</span><span class="op">(</span>ef_data<span class="op">=</span><span class="va">ef</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span>,</span>
<span>                                                          x<span class="op">=</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">Real.rich</span>,</span>
<span>                                                          VCV_sp<span class="op">=</span><span class="va">VCV_sp</span>,</span>
<span>                                                          ef_properties<span class="op">=</span><span class="va">ef_name</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>,</span>
<span>                                                          comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>                                                          family<span class="op">=</span><span class="va">family</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predict_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="va">predict_df</span><span class="op">)</span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">predict_df</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">sig_binary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">predict_df</span><span class="op">$</span><span class="va">sig</span> <span class="op">&lt;</span> <span class="fl">0.05</span>,<span class="st">"Significant"</span>,<span class="st">"Insignificant"</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s visualize the findings</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">KSR_EF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">ef_name</span><span class="op">)</span><span class="op">|</span><span class="st">"Real.rich"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#select(contains("2015.2017") | contains("NumSp")) %&gt;%</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">Real.rich</span>,names_to<span class="op">=</span><span class="st">"ef"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span><span class="op">$</span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">ef</span>,</span>
<span>                            <span class="st">"litter2012"</span>,</span>
<span>                            <span class="st">"ave.biomass"</span>,</span>
<span>                            <span class="st">"LAI"</span>,</span>
<span>                            <span class="st">"poll_total"</span>,</span>
<span>                            <span class="st">"log_flwr_total"</span>,</span>
<span>                            <span class="st">"Mass.loss.2month"</span>,</span>
<span>                            <span class="st">"Damage_effect"</span>,</span>
<span>                            <span class="st">"mean.N.change"</span>,</span>
<span>                            <span class="st">"bugs"</span>,</span>
<span>                            <span class="st">"bug.rich"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">predict_df</span><span class="op">$</span><span class="va">ef</span>,</span>
<span>                             <span class="st">"litter2012"</span>,</span>
<span>                             <span class="st">"ave.biomass"</span>,</span>
<span>                             <span class="st">"LAI"</span>,</span>
<span>                             <span class="st">"poll_total"</span>,</span>
<span>                             <span class="st">"log_flwr_total"</span>,</span>
<span>                             <span class="st">"Mass.loss.2month"</span>,</span>
<span>                             <span class="st">"Damage_effect"</span>,</span>
<span>                             <span class="st">"mean.N.change"</span>,</span>
<span>                             <span class="st">"bugs"</span>,</span>
<span>                             <span class="st">"bug.rich"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Gaussian</span><span class="op">/</span><span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Comm</span></span>
<span><span class="va">predict_df</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Gaussian</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">predict_df</span><span class="op">$</span><span class="va">hyper_Comm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">predict_df</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">value</span>,x<span class="op">=</span><span class="va">Real.rich</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">predicted</span>,x<span class="op">=</span><span class="va">x</span>,colour<span class="op">=</span><span class="va">model</span>,linetype<span class="op">=</span><span class="va">sig_binary</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">predicted</span>,x<span class="op">=</span><span class="va">x</span>,fill<span class="op">=</span><span class="va">model</span>,ymin<span class="op">=</span><span class="va">conf.low</span>,ymax<span class="op">=</span><span class="va">conf.high</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.3</span>,colour<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">ef</span>,scales<span class="op">=</span><span class="st">"free"</span>,nrow<span class="op">=</span><span class="fl">5</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Species richness"</span>,y<span class="op">=</span><span class="st">"Ecosystem Function"</span>,colour<span class="op">=</span><span class="st">"Model"</span>,fill<span class="op">=</span><span class="st">"Model"</span>,linetype<span class="op">=</span><span class="st">"Significance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>,<span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>,<span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Toby Pak Nok Tsang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
