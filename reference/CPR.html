<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Conducting Bayesian generalized linear mixed models for community data using INLA."><title>Phylogenetic bayesian generalized linear mixed models for community data — CPR • CPR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Phylogenetic bayesian generalized linear mixed models for community data — CPR"><meta property="og:description" content="Conducting Bayesian generalized linear mixed models for community data using INLA."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CPR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Empirical_multiple.html">Empirical Analyses with CPR - Multiple Functions</a>
    <a class="dropdown-item" href="../articles/Empirical_single.html">Empirical Analyses with CPR - Single Function</a>
    <a class="dropdown-item" href="../articles/Simulation.html">Simulation with CPR</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tpaknok/CPR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Phylogenetic bayesian generalized linear mixed models for community data</h1>
      
      <div class="d-none name"><code>CPR.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Conducting Bayesian generalized linear mixed models for community data using INLA.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CPR</span><span class="op">(</span><span class="va">formula</span>,</span>
<span>    priors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">df</span>,</span>
<span>    <span class="va">VCV_sp</span>,</span>
<span>    <span class="va">comm</span>,</span>
<span>    <span class="va">family</span>,</span>
<span>    optim.lambda <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    original.VCV <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    optim.control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    control.compute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>waic <span class="op">=</span> <span class="cn">TRUE</span>, config <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    prediction.df <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>    predictedfittedresponse <span class="op">=</span> <span class="st">"best_m"</span>,</span>
<span>    inla.rerun <span class="op">=</span> <span class="fl">1</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>an INLA formula.</p></dd>

  <dt>priors</dt>
<dd><p>prior specifications. If NULL default priors will be used. Use <code>inla.list.models("prior")</code> to see all prior available.</p></dd>

  <dt>df</dt>
<dd><p>a data frame with the response and predictors</p></dd>

  <dt>VCV_sp</dt>
<dd><p>a phylogenetic covariance matrix at species levels</p></dd>

  <dt>comm</dt>
<dd><p>a species site matrix</p></dd>

  <dt>family</dt>
<dd><p>error distribution in the glmm. Defaulted as "gaussian". Use <code>inla.list.models("likelihood")</code> to see all distribution available.</p></dd>

  <dt>optim.lambda</dt>
<dd><p>TRUE/FALSE. If TRUE, the function will optimize the (\(\lambda\)).</p></dd>

  <dt>original.VCV</dt>
<dd><p>TRUE/FALSE. If TRUE, the function will build a model based on the phylogenetic covariance matrix supplied by the user.</p></dd>

  <dt>optim.control</dt>
<dd><p>additional arguments passing to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.</p></dd>

  <dt>control.compute</dt>
<dd><p>arguments for control.compute in the <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></code> function.</p></dd>

  <dt>prediction.df</dt>
<dd><p>model predictions. If "auto", the model will provide predictions of a focal relatonship (e.g. ecosystem function and biodiversity) by holding other covariates at their mean (continuous) or mode (nominal) values. Users can also provide a data frame and ask INLA to make model predictions. The data frame must have the same structure as the analyzed datset, and users can define the conditions of different X while setting the response as NA.</p></dd>

  <dt>predictedfittedresponse</dt>
<dd><p>compute the median posterior predictions of the best model ("best_m"), models with the phylogenetic covariance matrix supplied by users ("original_VCV"), or models without phylogenetic effect ("no_phylo"). The results can then passed to <code><a href="https://rdrr.io/pkg/DHARMa/man/createDHARMa.html" class="external-link">createDHARMa</a></code>. Defaulted as "best_m".</p></dd>

  <dt>inla.rerun</dt>
<dd><p>number of times to rerun INLA models to ensure stable results. Defaulted as 1.</p></dd>

  <dt>...</dt>
<dd><p>additional arguments passing to <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When specifying the random effect, use <code>Cmatrix = Phylo</code> to indicate the phylogenetic covariance between communities, and <code>comm</code> as the identity of each community. See examples. You don't need to create them in the data frame. CPR will automatically create these for you in the internal environment.</p>
<p>The model will always compare the wAIC between the model without considering phylogeny and the model with optimized (\(\lambda\)). The model without phylogeny will be selected as "best model" if the wAIC does not reduce more than 2 after including the optimized/original \(\lambda\), which means $$wAIC_{optimized/original} - wAIC_{without\_phylogeny} &gt; -2$$</p>
<p>Note that even if optimized (\(\lambda\)) = 0, the model is not equivalent to a linear regression, as the covariance matrices will still consider species overlap between communities. Therefore, the off-diagnoals in glmm are still not zeroes.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <dl><dt>best_model</dt>
<dd><p>INLA output for the best model</p></dd>

  <dt>best_model_name</dt>
<dd><p>The model identified as the "best".</p></dd>

  <dt>predictedfittedresponse</dt>
<dd><p>median posterior predictions</p></dd>

  <dt>wAIC</dt>
<dd><p>wAIC of models (without phylogeny, with the user supplied phylogenetic covariance matrix, and with the optimized phylogeny).</p></dd>

  <dt>R2</dt>
<dd><p>R-squared calculated as correlations between the observed responses and the mean posterior predictions</p></dd>

  <dt>optim_lambda</dt>
<dd><p>The value of the optimized \(\lambda\).</p></dd>

  <dt>initial_formula</dt>
<dd><p>initial formula provided by users.</p></dd>

  <dt>without_phylo_model</dt>
<dd><p>results on the fixed effects from the model without phylogeny.</p></dd>

  <dt>optimized_model</dt>
<dd><p>results on the fixed effects from the model after optimizing phylogeny.</p></dd>

  <dt>original_VCV_model</dt>
<dd><p>results on the fixed effects from the model based on the covariance matrix provided by users.</p></dd>

  <dt>Cmatrix</dt>
<dd><p>The phylogentic matrix in the optimization model. Note that this is a precision matrix instead of a covariance matrix to fulfill the requirement of INLA</p></dd>

  <dt>prediction</dt>
<dd><p>predictted values for new data.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Toby P.N. Tsang</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="CPR_GLS.html">CPR_GLS</a></code>, <code><a href="get_comm_pair.html">get_comm_pair_r</a></code>, <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tpaknok/CPR" class="external-link">CPR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KSR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">inla_m</span> <span class="op">&lt;-</span> <span class="fu">CPR</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">bugs</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu">f</span><span class="op">(</span><span class="va">comm</span>,model<span class="op">=</span><span class="st">"generic0"</span>,Cmatrix<span class="op">=</span><span class="va">Phylo</span><span class="op">)</span>,</span>
<span>              priors<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              df <span class="op">=</span> <span class="va">KSR_EF</span>,</span>
<span>              VCV_sp <span class="op">=</span> <span class="va">VCV_sp</span>,</span>
<span>              comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>              family<span class="op">=</span><span class="st">"nbinomial"</span>,</span>
<span>              optim.lambda <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">inla_m</span><span class="op">$</span><span class="va">best_model</span><span class="op">)</span></span>
<span><span class="va">inla_m</span><span class="op">$</span><span class="va">prediction</span> <span class="co">#see predicted relationships at each unique value of the a covariate, while holding others at the mean value.</span></span>
<span><span class="va">inla_m</span><span class="op">$</span><span class="va">wAIC</span> <span class="co">#wAIC of different models. Note that wAIC_optim has the lowest wAIC.</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Toby Pak Nok Tsang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

